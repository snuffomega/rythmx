<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rythmx - Automated Music Discovery</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <!-- Tailwind CSS (CDN — no build tools required) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        background:          '#050505',
                        surface:             '#121212',
                        'surface-highlight': '#1E1E1E',
                        'text-primary':      '#EDEDED',
                        'text-secondary':    '#A1A1AA',
                        'text-muted':        '#52525B',
                        'accent-primary':    '#7B61FF',
                        'accent-secondary':  '#00F0FF',
                        'accent-danger':     '#FF3B30',
                        'accent-success':    '#10B981',
                        'accent-warning':    '#F59E0B',
                        'border-default':    '#27272A',
                        'border-active':     '#3F3F46'
                    },
                    fontFamily: {
                        display: ['Manrope', 'sans-serif'],
                        body:    ['Manrope', 'sans-serif'],
                        mono:    ['JetBrains Mono', 'monospace']
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons (CDN) -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="bg-background text-text-primary font-body antialiased">
<div id="app" class="flex min-h-screen">

    <!-- ── Sidebar ─────────────────────────────────── -->
    <aside id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-surface border-r border-border-default flex flex-col z-30">
        <div class="p-6 border-b border-border-default">
            <h1 class="font-display text-2xl font-bold text-text-primary flex items-center gap-2">
                <span class="w-8 h-8 rounded-lg bg-accent-primary flex items-center justify-center">
                    <i data-lucide="disc-3" class="w-5 h-5 text-white"></i>
                </span>
                rythmx
            </h1>
            <p class="text-text-muted text-xs mt-1">Automated Music Discovery</p>
        </div>

        <nav class="flex-1 p-4">
            <ul class="space-y-1">
                <li><a href="#discovery" data-page="discovery"
                       class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-text-secondary hover:text-text-primary hover:bg-surface-highlight transition-all">
                    <i data-lucide="sparkles" class="w-5 h-5"></i><span>Discovery</span>
                </a></li>
                <li><a href="#cruise-control" data-page="cruise-control"
                       class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-text-secondary hover:text-text-primary hover:bg-surface-highlight transition-all">
                    <i data-lucide="gauge" class="w-5 h-5"></i><span>Cruise Control</span>
                </a></li>
                <li><a href="#playlists" data-page="playlists"
                       class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-text-secondary hover:text-text-primary hover:bg-surface-highlight transition-all">
                    <i data-lucide="list-music" class="w-5 h-5"></i><span>Playlists</span>
                </a></li>
                <li><a href="#stats" data-page="stats"
                       class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-text-secondary hover:text-text-primary hover:bg-surface-highlight transition-all">
                    <i data-lucide="bar-chart-3" class="w-5 h-5"></i><span>Stats</span>
                </a></li>
                <li><a href="#settings" data-page="settings"
                       class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-text-secondary hover:text-text-primary hover:bg-surface-highlight transition-all">
                    <i data-lucide="settings" class="w-5 h-5"></i><span>Settings</span>
                </a></li>
            </ul>
        </nav>

        <div class="p-4 border-t border-border-default">
            <div id="connection-status" class="flex items-center gap-2 text-xs text-text-muted">
                <span class="w-2 h-2 rounded-full bg-accent-success animate-pulse"></span>
                <span>Connected</span>
            </div>
        </div>
    </aside>

    <!-- ── Main Content ─────────────────────────────── -->
    <main class="flex-1 ml-64">

        <!-- ── Discovery Page ─────────────────────── -->
        <section id="page-discovery" class="page hidden p-8">
            <header class="mb-8">
                <h2 class="font-display text-4xl font-bold mb-2">Discovery</h2>
                <p class="text-text-secondary">Scored recommendations from your discovery pool</p>
            </header>

            <div class="flex flex-wrap gap-3 mb-8">
                <button data-filter="all"        class="filter-btn active px-4 py-2 rounded-full bg-surface-highlight border border-border-default text-sm transition-all">All</button>
                <button data-filter="new"        class="filter-btn px-4 py-2 rounded-full bg-surface border border-border-default text-sm hover:border-accent-primary transition-all">New Releases</button>
                <button data-filter="unowned"    class="filter-btn px-4 py-2 rounded-full bg-surface border border-border-default text-sm hover:border-accent-primary transition-all">Unowned Only</button>
                <button data-filter="high-score" class="filter-btn px-4 py-2 rounded-full bg-surface border border-border-default text-sm hover:border-accent-primary transition-all">High Score (60+)</button>
            </div>

            <div class="flex gap-8">
                <div class="flex-1">
                    <div id="discovery-loading" class="text-center py-16">
                        <div class="inline-block w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"></div>
                        <p class="text-text-secondary mt-4">Loading discoveries...</p>
                    </div>

                    <div id="discovery-empty" class="hidden text-center py-16">
                        <i data-lucide="disc" class="w-16 h-16 mx-auto text-text-muted mb-4"></i>
                        <p class="text-text-secondary">No tracks found. Configure your SoulSync connection.</p>
                    </div>

                    <div id="discovery-grid" class="hidden grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"></div>
                </div>

                <!-- Playlist Panel -->
                <aside class="w-80 shrink-0">
                    <div class="bg-surface rounded-2xl border border-border-default p-6 sticky top-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-display text-xl font-semibold">For You</h3>
                            <span id="playlist-count" class="text-xs text-text-muted bg-surface-highlight px-2 py-1 rounded">0 tracks</span>
                        </div>

                        <div id="playlist-empty" class="text-center py-8 text-text-muted text-sm">
                            <i data-lucide="list-music" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                            <p>Add tracks to your playlist</p>
                        </div>

                        <div id="playlist-tracks" class="space-y-2 max-h-96 overflow-y-auto mb-4"></div>

                        <div class="space-y-2 pt-4 border-t border-border-default">
                            <button id="btn-publish-plex"
                                    class="w-full px-4 py-3 rounded-xl bg-accent-primary text-white font-medium hover:bg-opacity-90 transition-all flex items-center justify-center gap-2">
                                <i data-lucide="upload-cloud" class="w-4 h-4"></i>Publish to Plex
                            </button>
                            <button id="btn-export-m3u"
                                    class="w-full px-4 py-3 rounded-xl bg-surface-highlight border border-border-default text-text-primary font-medium hover:border-accent-primary transition-all flex items-center justify-center gap-2">
                                <i data-lucide="download" class="w-4 h-4"></i>Export M3U
                            </button>
                        </div>
                    </div>
                </aside>
            </div>
        </section>

        <!-- ── Cruise Control Page ─────────────────── -->
        <section id="page-cruise-control" class="page hidden p-8">
            <header class="mb-8">
                <h2 class="font-display text-4xl font-bold mb-2">Cruise Control</h2>
                <p class="text-text-secondary">Automated acquisition cycle settings and status</p>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Config Panel -->
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <h3 class="font-display text-xl font-semibold mb-6 flex items-center gap-2">
                        <i data-lucide="sliders-horizontal" class="w-5 h-5 text-accent-primary"></i>Configuration
                    </h3>

                    <!-- Field name attributes use backend key names directly -->
                    <form id="cc-config-form" class="space-y-6">

                        <div class="flex items-center justify-between">
                            <label class="text-text-primary">Enable Automation</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="cc-enabled" name="cc_enabled" class="sr-only peer">
                                <div class="w-11 h-6 bg-surface-highlight rounded-full peer peer-checked:bg-accent-primary transition-colors"></div>
                                <div class="absolute left-1 top-1 w-4 h-4 bg-text-muted rounded-full peer-checked:translate-x-5 peer-checked:bg-white transition-all"></div>
                            </label>
                        </div>

                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Minimum Play Count</label>
                            <input type="number" id="cc-min-listens" name="cc_min_listens" value="10" min="1" max="1000"
                                   class="w-full bg-surface-highlight border border-border-default rounded-xl px-4 py-3 text-text-primary focus:outline-none focus:border-accent-primary transition-colors">
                            <p class="text-xs text-text-muted mt-1">Artists with at least X plays in the selected period</p>
                        </div>

                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Listening Period</label>
                            <select id="cc-period" name="cc_period"
                                    class="w-full bg-surface-highlight border border-border-default rounded-xl px-4 py-3 text-text-primary focus:outline-none focus:border-accent-primary transition-colors appearance-none cursor-pointer">
                                <option value="7day">Last 7 days</option>
                                <option value="1month">Last 30 days</option>
                                <option value="3month">Last 3 months</option>
                                <option value="6month" selected>Last 6 months</option>
                                <option value="12month">Last year</option>
                                <option value="overall">All time</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Release Lookback (days)</label>
                            <input type="number" id="cc-lookback" name="cc_lookback_days" value="90" min="7" max="365"
                                   class="w-full bg-surface-highlight border border-border-default rounded-xl px-4 py-3 text-text-primary focus:outline-none focus:border-accent-primary transition-colors">
                            <p class="text-xs text-text-muted mt-1">Consider releases from the last X days</p>
                        </div>

                        <div>
                            <label class="block text-sm text-text-secondary mb-2">Max Downloads per Cycle</label>
                            <input type="number" id="cc-max" name="cc_max_per_cycle" value="10" min="1" max="500"
                                   class="w-full bg-surface-highlight border border-border-default rounded-xl px-4 py-3 text-text-primary focus:outline-none focus:border-accent-primary transition-colors">
                        </div>

                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    <label class="text-text-primary">Run Mode</label>
                                    <p class="text-xs text-text-muted" id="cc-run-mode-desc">Scan + build playlist from owned new releases, no downloads</p>
                                </div>
                                <div class="flex rounded-lg overflow-hidden border border-border-default" id="cc-run-mode-toggle">
                                    <button type="button" data-mode="dry"      class="cc-mode-btn px-3 py-1.5 text-sm">Dry</button>
                                    <button type="button" data-mode="playlist" class="cc-mode-btn px-3 py-1.5 text-sm">Playlist</button>
                                    <button type="button" data-mode="cruise"   class="cc-mode-btn px-3 py-1.5 text-sm">Cruise</button>
                                </div>
                                <input type="hidden" id="cc-run-mode" name="cc_run_mode" value="playlist">
                            </div>
                        </div>

                        <div class="flex items-center justify-between" id="cc-playlist-prefix-row">
                            <div>
                                <label class="text-text-primary">Playlist name prefix</label>
                                <p class="text-xs text-text-muted">Date suffix added automatically (e.g. New Music_2026-02-25)</p>
                            </div>
                            <input type="text" id="cc-playlist-prefix" name="cc_playlist_prefix"
                                   class="bg-surface-highlight border border-border-default rounded-xl px-3 py-2 text-text-primary text-sm w-40 focus:outline-none focus:border-accent-primary transition-colors"
                                   placeholder="New Music">
                        </div>

                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-text-primary">Auto-publish to Plex</label>
                                <p class="text-xs text-text-muted">Push playlist after each cycle</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="cc-auto-push" name="cc_auto_push_playlist" class="sr-only peer">
                                <div class="w-11 h-6 bg-surface-highlight rounded-full peer peer-checked:bg-accent-success transition-colors"></div>
                                <div class="absolute left-1 top-1 w-4 h-4 bg-text-muted rounded-full peer-checked:translate-x-5 peer-checked:bg-white transition-all"></div>
                            </label>
                        </div>

                        <button type="submit"
                                class="w-full px-4 py-3 rounded-xl bg-accent-primary text-white font-medium hover:bg-opacity-90 transition-all">
                            Save Configuration
                        </button>
                    </form>
                </div>

                <!-- Status Panel -->
                <div class="space-y-6">
                    <div class="bg-surface rounded-2xl border border-border-default p-6">
                        <h3 class="font-display text-xl font-semibold mb-6 flex items-center gap-2">
                            <i data-lucide="activity" class="w-5 h-5 text-accent-secondary"></i>Pipeline Status
                        </h3>

                        <div id="pipeline-stages" class="space-y-3">
                            <div class="stage flex items-center gap-3" data-stage="1">
                                <span class="w-6 h-6 rounded-full bg-surface-highlight flex items-center justify-center text-xs shrink-0">1</span>
                                <span class="flex-1 text-sm text-text-secondary">Poll Last.fm history</span>
                                <i data-lucide="circle" class="w-4 h-4 text-text-muted stage-icon shrink-0"></i>
                            </div>
                            <div class="stage flex items-center gap-3" data-stage="2">
                                <span class="w-6 h-6 rounded-full bg-surface-highlight flex items-center justify-center text-xs shrink-0">2</span>
                                <span class="flex-1 text-sm text-text-secondary">Resolve artist identities</span>
                                <i data-lucide="circle" class="w-4 h-4 text-text-muted stage-icon shrink-0"></i>
                            </div>
                            <div class="stage flex items-center gap-3" data-stage="3">
                                <span class="w-6 h-6 rounded-full bg-surface-highlight flex items-center justify-center text-xs shrink-0">3</span>
                                <span class="flex-1 text-sm text-text-secondary">Find new releases</span>
                                <i data-lucide="circle" class="w-4 h-4 text-text-muted stage-icon shrink-0"></i>
                            </div>
                            <div class="stage flex items-center gap-3" data-stage="4">
                                <span class="w-6 h-6 rounded-full bg-surface-highlight flex items-center justify-center text-xs shrink-0">4</span>
                                <span class="flex-1 text-sm text-text-secondary">Owned-check vs library</span>
                                <i data-lucide="circle" class="w-4 h-4 text-text-muted stage-icon shrink-0"></i>
                            </div>
                            <div class="stage flex items-center gap-3" data-stage="5">
                                <span class="w-6 h-6 rounded-full bg-surface-highlight flex items-center justify-center text-xs shrink-0">5</span>
                                <span class="flex-1 text-sm text-text-secondary">Build download queue <span class="text-xs text-text-muted">(Cruise only)</span></span>
                                <i data-lucide="circle" class="w-4 h-4 text-text-muted stage-icon shrink-0"></i>
                            </div>
                            <div class="stage flex items-center gap-3" data-stage="6">
                                <span class="w-6 h-6 rounded-full bg-surface-highlight flex items-center justify-center text-xs shrink-0">6</span>
                                <span class="flex-1 text-sm text-text-secondary">Queue downloads <span class="text-xs text-text-muted">(Cruise only)</span></span>
                                <i data-lucide="circle" class="w-4 h-4 text-text-muted stage-icon shrink-0"></i>
                            </div>
                            <div class="stage flex items-center gap-3" data-stage="7">
                                <span class="w-6 h-6 rounded-full bg-surface-highlight flex items-center justify-center text-xs shrink-0">7</span>
                                <span class="flex-1 text-sm text-text-secondary">Build playlist &amp; publish</span>
                                <i data-lucide="circle" class="w-4 h-4 text-text-muted stage-icon shrink-0"></i>
                            </div>
                        </div>

                        <button id="btn-run-now"
                                class="w-full mt-6 px-4 py-3 rounded-xl bg-accent-secondary text-black font-medium hover:bg-opacity-90 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="play" class="w-4 h-4"></i>Run Now
                        </button>
                    </div>

                    <!-- Last Run Results -->
                    <div class="bg-surface rounded-2xl border border-border-default p-6">
                        <h3 class="font-display text-xl font-semibold mb-4 flex items-center gap-2">
                            <i data-lucide="check-circle-2" class="w-5 h-5 text-accent-success"></i>Last Run Results
                        </h3>
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-text-secondary">Last run:</span>
                                <span id="cc-last-run" class="text-text-primary">Never</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-text-secondary">Releases found:</span>
                                <span id="cc-considered" class="text-text-primary">—</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-text-secondary">Already owned:</span>
                                <span id="cc-owned" class="text-text-primary">—</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-text-secondary">Queued:</span>
                                <span id="cc-queued" class="text-accent-success">—</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-text-secondary">Failed:</span>
                                <span id="cc-failed" class="text-accent-danger">—</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-text-secondary">Provider:</span>
                                <span id="cc-provider" class="text-text-muted font-mono text-xs">—</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Table -->
            <div class="mt-8 bg-surface rounded-2xl border border-border-default p-6">
                <h3 class="font-display text-xl font-semibold mb-6 flex items-center gap-2">
                    <i data-lucide="history" class="w-5 h-5 text-accent-primary"></i>Cycle History
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="text-left text-text-muted border-b border-border-default">
                                <th class="pb-3 font-medium">Artist</th>
                                <th class="pb-3 font-medium">Album</th>
                                <th class="pb-3 font-medium">Source</th>
                                <th class="pb-3 font-medium">Status</th>
                                <th class="pb-3 font-medium">Date</th>
                            </tr>
                        </thead>
                        <tbody id="cc-history-table"></tbody>
                    </table>
                </div>
                <div id="cc-history-empty" class="text-center py-8 text-text-muted">No cycle history yet</div>
            </div>
        </section>

        <!-- ── Playlists Page ─────────────────────── -->
        <section id="page-playlists" class="page hidden p-8">
            <header class="flex items-center justify-between mb-8">
                <div>
                    <h2 class="font-display text-4xl font-bold mb-2">Playlists</h2>
                    <p class="text-text-secondary">Manage and publish your playlists</p>
                </div>
                <button id="btn-new-playlist"
                        class="px-5 py-3 rounded-xl bg-accent-primary text-white font-medium hover:bg-opacity-90 transition-all flex items-center gap-2">
                    <i data-lucide="plus" class="w-4 h-4"></i>New Playlist
                </button>
            </header>

            <div id="playlists-loading" class="text-center py-16">
                <div class="inline-block w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"></div>
                <p class="text-text-secondary mt-4">Loading playlists...</p>
            </div>

            <div id="playlists-empty" class="hidden text-center py-16">
                <i data-lucide="list-music" class="w-16 h-16 mx-auto text-text-muted mb-4"></i>
                <p class="text-text-secondary mb-4">No playlists yet. Create one to get started.</p>
                <button class="px-5 py-3 rounded-xl bg-accent-primary text-white font-medium hover:bg-opacity-90 transition-all inline-flex items-center gap-2"
                        onclick="document.getElementById('btn-new-playlist').click()">
                    <i data-lucide="plus" class="w-4 h-4"></i>Create your first playlist
                </button>
            </div>

            <div id="playlists-list" class="hidden space-y-4"></div>
        </section>

        <!-- ── Stats Page ──────────────────────────── -->
        <section id="page-stats" class="page hidden p-8">
            <header class="mb-8">
                <h2 class="font-display text-4xl font-bold mb-2">Stats</h2>
                <p class="text-text-secondary">Your listening history and discovery metrics</p>
            </header>

            <div class="mb-8">
                <select id="stats-period"
                        class="bg-surface-highlight border border-border-default rounded-xl px-4 py-3 text-text-primary focus:outline-none focus:border-accent-primary transition-colors">
                    <option value="7day">Last 7 days</option>
                    <option value="1month">Last 30 days</option>
                    <option value="3month">Last 3 months</option>
                    <option value="6month" selected>Last 6 months</option>
                    <option value="12month">Last year</option>
                    <option value="overall">All time</option>
                </select>
            </div>

            <!-- Summary Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <i data-lucide="download" class="w-5 h-5 text-accent-primary"></i>
                        <span class="text-text-secondary text-sm">Queued</span>
                    </div>
                    <p id="stat-downloaded" class="font-display text-3xl font-bold">0</p>
                </div>
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <i data-lucide="heart" class="w-5 h-5 text-accent-danger"></i>
                        <span class="text-text-secondary text-sm">Loved Artists</span>
                    </div>
                    <p id="stat-loved" class="font-display text-3xl font-bold">0</p>
                </div>
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <i data-lucide="users" class="w-5 h-5 text-accent-secondary"></i>
                        <span class="text-text-secondary text-sm">Top Artists</span>
                    </div>
                    <p id="stat-artists" class="font-display text-3xl font-bold">0</p>
                </div>
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <div class="flex items-center gap-3 mb-2">
                        <i data-lucide="music" class="w-5 h-5 text-accent-success"></i>
                        <span class="text-text-secondary text-sm">Top Tracks</span>
                    </div>
                    <p id="stat-tracks" class="font-display text-3xl font-bold">0</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Top Artists -->
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <h3 class="font-display text-xl font-semibold mb-6 flex items-center gap-2">
                        <i data-lucide="mic-2" class="w-5 h-5 text-accent-primary"></i>Top Artists
                    </h3>
                    <div id="top-artists-list" class="space-y-3"></div>
                    <div id="top-artists-empty" class="text-center py-8 text-text-muted text-sm">
                        Connect Last.fm to see your top artists
                    </div>
                </div>

                <!-- Top Tracks -->
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <h3 class="font-display text-xl font-semibold mb-6 flex items-center gap-2">
                        <i data-lucide="music-2" class="w-5 h-5 text-accent-secondary"></i>Top Tracks
                    </h3>
                    <div id="top-tracks-list" class="space-y-3"></div>
                    <div id="top-tracks-empty" class="text-center py-8 text-text-muted text-sm">
                        Connect Last.fm to see your top tracks
                    </div>
                </div>
            </div>

            <!-- CC Summary -->
            <div class="bg-surface rounded-2xl border border-border-default p-6">
                <h3 class="font-display text-xl font-semibold mb-6 flex items-center gap-2">
                    <i data-lucide="gauge" class="w-5 h-5 text-accent-warning"></i>Cruise Control Summary
                </h3>
                <div id="cc-summary-body" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>
                <div id="cc-summary-empty" class="text-center py-4 text-text-muted text-sm">No cycle history yet</div>
            </div>
        </section>

        <!-- ── Settings Page ───────────────────────── -->
        <section id="page-settings" class="page hidden p-8">
            <header class="mb-8">
                <h2 class="font-display text-4xl font-bold mb-2">Settings</h2>
                <p class="text-text-secondary">Connection status — configure credentials in your <code class="font-mono text-accent-primary">.env</code> file</p>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Last.fm -->
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <h3 class="font-display text-xl font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="radio" class="w-5 h-5 text-accent-danger"></i>Last.fm
                    </h3>
                    <p class="text-text-muted text-xs mb-4">
                        Set <code class="font-mono text-accent-primary">LASTFM_API_KEY</code> + <code class="font-mono text-accent-primary">LASTFM_USERNAME</code>
                    </p>
                    <div id="lastfm-status" class="text-sm mb-4 min-h-5 text-text-muted"></div>
                    <button id="btn-test-lastfm"
                            class="w-full px-4 py-3 rounded-xl bg-surface-highlight border border-border-default text-text-primary font-medium hover:border-accent-primary transition-all flex items-center justify-center gap-2">
                        <i data-lucide="plug" class="w-4 h-4"></i>Test Connection
                    </button>
                </div>

                <!-- Plex -->
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <h3 class="font-display text-xl font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="tv" class="w-5 h-5 text-accent-warning"></i>Plex
                    </h3>
                    <p class="text-text-muted text-xs mb-4">
                        Set <code class="font-mono text-accent-primary">PLEX_URL</code> + <code class="font-mono text-accent-primary">PLEX_TOKEN</code>
                    </p>
                    <div id="plex-status" class="text-sm mb-4 min-h-5 text-text-muted"></div>
                    <button id="btn-test-plex"
                            class="w-full px-4 py-3 rounded-xl bg-surface-highlight border border-border-default text-text-primary font-medium hover:border-accent-primary transition-all flex items-center justify-center gap-2">
                        <i data-lucide="plug" class="w-4 h-4"></i>Test Connection
                    </button>
                </div>

                <!-- SoulSync -->
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <h3 class="font-display text-xl font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="database" class="w-5 h-5 text-accent-secondary"></i>SoulSync
                    </h3>
                    <p class="text-text-muted text-xs mb-4">
                        Set <code class="font-mono text-accent-primary">SOULSYNC_URL</code> + <code class="font-mono text-accent-primary">SOULSYNC_DB</code>
                    </p>
                    <div id="soulsync-status" class="text-sm mb-4 min-h-5 text-text-muted"></div>
                    <button id="btn-test-soulsync"
                            class="w-full px-4 py-3 rounded-xl bg-surface-highlight border border-border-default text-text-primary font-medium hover:border-accent-primary transition-all flex items-center justify-center gap-2">
                        <i data-lucide="plug" class="w-4 h-4"></i>Test Connection
                    </button>
                </div>

                <!-- Spotify -->
                <div class="bg-surface rounded-2xl border border-border-default p-6">
                    <h3 class="font-display text-xl font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="disc-3" class="w-5 h-5 text-accent-success"></i>Spotify
                        <span class="text-xs font-normal text-text-muted">(optional — enables release discovery)</span>
                    </h3>
                    <p class="text-text-muted text-xs mb-4">
                        Set <code class="font-mono text-accent-primary">SPOTIFY_CLIENT_ID</code> + <code class="font-mono text-accent-primary">SPOTIFY_CLIENT_SECRET</code>
                    </p>
                    <div id="spotify-status" class="text-sm mb-4 min-h-5 text-text-muted"></div>
                    <button id="btn-test-spotify"
                            class="w-full px-4 py-3 rounded-xl bg-surface-highlight border border-border-default text-text-primary font-medium hover:border-accent-primary transition-all flex items-center justify-center gap-2">
                        <i data-lucide="plug" class="w-4 h-4"></i>Test Connection
                    </button>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="mt-8 bg-surface rounded-2xl border border-accent-danger/30 p-6">
                <h3 class="font-display text-xl font-semibold mb-4 text-accent-danger flex items-center gap-2">
                    <i data-lucide="alert-triangle" class="w-5 h-5"></i>Danger Zone
                </h3>
                <p class="text-text-secondary text-sm mb-4">These actions cannot be undone.</p>
                <div class="flex gap-4">
                    <button id="btn-clear-history"
                            class="px-4 py-2 rounded-xl border border-accent-danger/50 text-accent-danger text-sm hover:bg-accent-danger/10 transition-all">
                        Clear History
                    </button>
                    <button id="btn-reset-db"
                            class="px-4 py-2 rounded-xl border border-accent-danger/50 text-accent-danger text-sm hover:bg-accent-danger/10 transition-all">
                        Reset Database
                    </button>
                </div>
            </div>
        </section>

    </main>
</div>

<!-- Toast Container -->
<div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

<!-- Confirmation Modal -->
<div id="confirm-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4">
        <div class="bg-surface rounded-2xl border border-border-default p-6 max-w-md w-full relative">
            <h3 id="confirm-title" class="font-display text-xl font-semibold mb-2">Confirm Action</h3>
            <p id="confirm-message" class="text-text-secondary text-sm mb-6">Are you sure?</p>
            <div class="flex gap-3 justify-end">
                <button id="confirm-cancel" class="px-4 py-2 rounded-xl bg-surface-highlight text-text-primary hover:bg-border-active transition-colors">Cancel</button>
                <button id="confirm-ok"     class="px-4 py-2 rounded-xl bg-accent-danger text-white hover:bg-opacity-90 transition-colors">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- New Playlist Modal -->
<div id="new-playlist-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" id="new-playlist-backdrop"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4">
        <div class="bg-surface rounded-2xl border border-border-default p-6 max-w-lg w-full relative">
            <button id="close-playlist-modal" class="absolute top-4 right-4 text-text-muted hover:text-text-primary transition-colors">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <h3 class="font-display text-xl font-semibold mb-6 flex items-center gap-2">
                <i data-lucide="list-music" class="w-5 h-5 text-accent-primary"></i>New Playlist
            </h3>

            <form id="new-playlist-form" class="space-y-5">
                <div>
                    <label class="block text-sm text-text-secondary mb-2">Playlist Name</label>
                    <input type="text" id="pl-name" placeholder="My Playlist" required
                           class="w-full bg-surface-highlight border border-border-default rounded-xl px-4 py-3 text-text-primary focus:outline-none focus:border-accent-primary transition-colors">
                </div>

                <div>
                    <label class="block text-sm text-text-secondary mb-3">Source</label>
                    <div class="space-y-2">
                        <label class="flex items-start gap-3 p-3 rounded-xl border border-border-default hover:border-accent-primary cursor-pointer transition-colors has-[:checked]:border-accent-primary has-[:checked]:bg-accent-primary/5">
                            <input type="radio" name="pl-source" value="taste" class="mt-0.5 accent-accent-primary" checked>
                            <div>
                                <p class="text-text-primary font-medium text-sm">From my taste (Last.fm)</p>
                                <p class="text-text-muted text-xs mt-0.5">Scores your owned library tracks against your listening history</p>
                            </div>
                        </label>
                        <label class="flex items-start gap-3 p-3 rounded-xl border border-border-default hover:border-accent-primary cursor-pointer transition-colors has-[:checked]:border-accent-primary has-[:checked]:bg-accent-primary/5">
                            <input type="radio" name="pl-source" value="spotify" class="mt-0.5 accent-accent-primary">
                            <div>
                                <p class="text-text-primary font-medium text-sm">Import from Spotify</p>
                                <p class="text-text-muted text-xs mt-0.5">Match a public Spotify playlist against your library (requires Spotify credentials)</p>
                            </div>
                        </label>
                        <label class="flex items-start gap-3 p-3 rounded-xl border border-border-default hover:border-accent-primary cursor-pointer transition-colors has-[:checked]:border-accent-primary has-[:checked]:bg-accent-primary/5">
                            <input type="radio" name="pl-source" value="lastfm" class="mt-0.5 accent-accent-primary">
                            <div>
                                <p class="text-text-primary font-medium text-sm">Import from Last.fm playlist</p>
                                <p class="text-text-muted text-xs mt-0.5">Match a public Last.fm playlist against your library (uses your Last.fm API key)</p>
                            </div>
                        </label>
                        <label class="flex items-start gap-3 p-3 rounded-xl border border-border-default hover:border-accent-primary cursor-pointer transition-colors has-[:checked]:border-accent-primary has-[:checked]:bg-accent-primary/5">
                            <input type="radio" name="pl-source" value="deezer" class="mt-0.5 accent-accent-primary">
                            <div>
                                <p class="text-text-primary font-medium text-sm">Import from Deezer</p>
                                <p class="text-text-muted text-xs mt-0.5">Match a public Deezer playlist against your library (no credentials required)</p>
                            </div>
                        </label>
                        <label class="flex items-start gap-3 p-3 rounded-xl border border-border-default hover:border-accent-primary cursor-pointer transition-colors has-[:checked]:border-accent-primary has-[:checked]:bg-accent-primary/5">
                            <input type="radio" name="pl-source" value="manual" class="mt-0.5 accent-accent-primary">
                            <div>
                                <p class="text-text-primary font-medium text-sm">Empty playlist</p>
                                <p class="text-text-muted text-xs mt-0.5">Start blank — add tracks manually from Discovery</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- External import fields (shown for spotify / lastfm / deezer) -->
                <div id="pl-import-fields" class="hidden space-y-4">
                    <div>
                        <label class="block text-sm text-text-secondary mb-2">Playlist URL</label>
                        <input type="text" id="pl-source-url" placeholder="Paste playlist URL here"
                               class="w-full bg-surface-highlight border border-border-default rounded-xl px-4 py-3 text-text-primary focus:outline-none focus:border-accent-primary transition-colors font-mono text-sm">
                    </div>
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-text-primary text-sm">Keep synced automatically</p>
                            <p class="text-text-muted text-xs">Re-import on each CC cycle</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="pl-auto-sync" class="sr-only peer">
                            <div class="w-11 h-6 bg-surface-highlight rounded-full peer peer-checked:bg-accent-primary transition-colors"></div>
                            <div class="absolute left-1 top-1 w-4 h-4 bg-text-muted rounded-full peer-checked:translate-x-5 peer-checked:bg-white transition-all"></div>
                        </label>
                    </div>
                </div>

                <!-- Max tracks (shown for taste source) -->
                <div id="pl-taste-fields" class="space-y-2">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-text-primary text-sm">Max tracks</p>
                            <p class="text-text-muted text-xs">How many tracks to include in the playlist</p>
                        </div>
                        <input type="number" id="pl-max-tracks" min="10" max="500" value="50"
                               class="w-20 bg-surface-highlight border border-border-default rounded-xl px-3 py-2 text-text-primary text-sm text-center focus:outline-none focus:border-accent-primary transition-colors">
                    </div>
                </div>

                <div class="flex items-center justify-between pt-1">
                    <div>
                        <p class="text-text-primary text-sm">Mode</p>
                        <p class="text-text-muted text-xs">Acquisition support coming soon</p>
                    </div>
                    <span class="px-3 py-1 rounded-full bg-surface-highlight text-text-muted text-xs border border-border-default">Library only</span>
                </div>

                <div id="pl-create-error" class="hidden text-accent-danger text-sm"></div>

                <button type="submit" id="btn-create-playlist"
                        class="w-full px-4 py-3 rounded-xl bg-accent-primary text-white font-medium hover:bg-opacity-90 transition-all flex items-center justify-center gap-2">
                    <i data-lucide="plus" class="w-4 h-4"></i>Create Playlist
                </button>
            </form>
        </div>
    </div>
</div>

<script src="/static/script.js"></script>
</body>
</html>
